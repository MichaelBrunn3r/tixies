import{S as t,i as e,s as n,j as r,k as i,l as s,d as o,A as a,f as l,n as h,F as _,w as u,x as c,y as A}from"./client.6e025ad6.js";function f(t,e,n){const r=t.createShader(e);t.shaderSource(r,n),t.compileShader(r);if(!t.getShaderParameter(r,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(r);throw t.deleteShader(r),new Error(`Shader compilation error: ${e}`)}return r}function T(t,e,n=null){const r=document.getElementById(e);if(!r)throw new Error(`Couldn't find shader script element wit id #${e}`);if(null==n)if("x-shader/x-vertex"===r.type)n=t.VERTEX_SHADER;else if("x-shader/x-fragment"===r.type)n=t.FRAGMENT_SHADER;else if(n!==t.VERTEX_SHADER&&n!==t.FRAGMENT_SHADER)throw new Error(`Unknown shader type: ${n}`);return f(t,t.VERTEX_SHADER,r.textContent)}function p(t,e,n){const r=t.createProgram();t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r);if(!t.getProgramParameter(r,t.LINK_STATUS)){const e=t.getProgramInfoLog(r);throw t.deleteProgram(r),new Error(`Error while linking WebGL program: ${e}`)}return r}var d,E;!function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.DEFAULT=5126]="DEFAULT"}(d||(d={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.DEFAULT=5126]="DEFAULT"}(E||(E={}));class g{constructor(t,e,n,r,i){this.gl=t,this.size=e,this.type=d[d[n]],this.name=r,this.location=i,this._get_set_fn()}set(t){this.set_fn(t)}_get_set_fn(){this.type==d.FLOAT?this.set_fn=t=>this.gl.vertexAttrib1f(this.location,t):this.type==d.BOOL_VEC2||this.type==d.INT_VEC2||this.type==d.FLOAT_VEC2?this.set_fn=t=>this.gl.vertexAttrib2f(this.location,t[0],t[1]):this.type==d.BOOL_VEC3||this.type==d.INT_VEC3||this.type==d.FLOAT_VEC3?this.set_fn=t=>this.gl.vertexAttrib3f(this.location,t[0],t[1],t[2]):this.type!=d.BOOL_VEC4&&this.type!=d.INT_VEC4&&this.type!=d.FLOAT_VEC4||(this.set_fn=t=>this.gl.vertexAttrib4f(this.location,t[0],t[1],t[2],t[3]))}}class y{constructor(t,e,n,r,i){this.gl=t,this.size=e,this.type=E[E[n]],this.name=r,this.location=i,this._get_set_fn()}set(t){this.set_fn(t)}_get_set_fn(){this.type==E.FLOAT?this.set_fn=t=>this.gl.uniform1f(this.location,t):this.type==E.BOOL_VEC2||this.type==E.INT_VEC2||this.type==E.FLOAT_VEC2?this.set_fn=t=>this.gl.uniform2f(this.location,t[0],t[1]):this.type==E.BOOL_VEC3||this.type==E.INT_VEC3||this.type==E.FLOAT_VEC3?this.set_fn=t=>this.gl.uniform3f(this.location,t[0],t[1],t[2]):this.type!=E.BOOL_VEC4&&this.type!=E.INT_VEC4&&this.type!=E.FLOAT_VEC4||(this.set_fn=t=>this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class L{constructor(t,e){this.attribs={},this.uniforms={},this.gl=t,this.prog=e,this._get_attribs(),this._get_uniforms()}static fromSources(t,e,n){return new L(t,p(t,f(t,t.VERTEX_SHADER,e),f(t,t.FRAGMENT_SHADER,n)))}static fromScripts(t,e,n){return new L(t,p(t,T(t,e),T(t,n)))}use(){this.gl.useProgram(this.prog)}clear(t=0,e=0,n=0,r=0){this.gl.clearColor(t,e,n,r),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}location(t){return this.attribs[t].location}attribDivisor(t,e){this.gl.vertexAttribDivisor(this.attribs[t].location,e)}bufferData(t,e,n=WebGL2RenderingContext.STATIC_DRAW){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),n)}pointAttr(t,e,n,r=!1,i=0,s=0){const o=this.attribs[e];this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.enableVertexAttribArray(o.location),this.gl.vertexAttribPointer(o.location,n,this.gl.FLOAT,r,i,s)}_get_attribs(){const t=this.gl.getProgramParameter(this.prog,this.gl.ACTIVE_ATTRIBUTES);for(let e=0;e<t;e++){const t=this.gl.getActiveAttrib(this.prog,e);if(!t)break;this.attribs[t.name]=new g(this.gl,t.size,t.type,t.name,this.gl.getAttribLocation(this.prog,t.name))}}_get_uniforms(){const t=this.gl.getProgramParameter(this.prog,this.gl.ACTIVE_UNIFORMS);for(let e=0;e<t;e++){const t=this.gl.getActiveUniform(this.prog,e);if(!t)break;this.uniforms[t.name]=new y(this.gl,t.size,t.type,t.name,this.gl.getUniformLocation(this.prog,t.name))}}}var O={rectangle:function(t,e,n,r){return[t,e,n,e,t,r,t,r,n,e,n,r]}};class F{constructor(t,e,n=16,r=(F.DEFAULT_SPEED=100),i=null){this.name=t,this.code=e,this.n=n,this.speed=r,this.comments=i||new Array(t)}}F.DEFAULT_SPEED=100;const v={},m=[],x=[];function C(t,e){v[t]=e,m.push(t)}function w(t,e){v[t]=e,x.push(t)}C("sweep_up",new F("Sweep up","return sin(y/8+t);",16)),C("pulse",new F("Pulse","return sin(t);",16)),C("ripple_in",new F("Ripple In","return sin(sqrt(pow(n/2-x-0.5,2)+pow(n/2-y-0.5,2))+t);",16)),C("ripple_circ",new F("Circular Ripple","let radius = n/4;return sin(sqrt(pow(n/2-x-0.5+sin(t)*radius,2)+pow(n/2-y-0.5+cos(t)*radius,2))+t);",16)),C("triangle",new F("Triangle","return y+1>x && n-2-y<x;",16,0)),C("triangle-up",new F("Flying Triangle","let h=t*3%n;return y>x-h && y>n-1-x-h && y<n-h;",16)),C("grid",new F("Grid","return x%4 && y%4",16)),C("sirpinski",new F('<a href="https://en.wikipedia.org/wiki/Sierpi%C5%84ski_triangle">Sirpinski </a>',"return i & x & y & t*2",16)),C("square-collapse",new F("Collapsing Square","let v = ceil(t%(n/2)-1);return (x == v || n-1-x == v || y == v || n-1-y == v) && (x>v-1 && x<n-v && y>v-1 && y<n-v)")),C("ladder-blink",new F("Blinking Ladder","let px = floor(t%n);let py = floor((t/n)%n);return (x == (py%2 ? px : n-1-px) && y == py) * (i%2*-2+1)",6,2*F.DEFAULT_SPEED)),C("swiper",new F("Swiper","t*=14;let period = 2*n-2;return x == (floor(t%period) < period/2 ? floor(t%(period/2)): n-1-floor(t%(period/2)));",16)),C("swiper_laola",new F("Laola Swiper","return abs(floor(sin(t)*(n-1))) == x",16)),C("pong",new F("Pong","t=floor(t*3);\n\t\t\t\t\t\t\t\t\t\t\tlet px=2*(n-1)-2;\n\t\t\t\t\t\t\t\t\t\t\tlet ratio=2;\n\t\t\t\t\t\t\t\t\t\t\tlet py=(px+2)/ratio;\n\t\t\t\t\t\t\t\t\t\t\tlet ty= t+px/ratio/4;\n\t\t\t\t\t\t\t\t\t\t\tlet posy= y == floor((ty%py < py/2 ? ty*ratio%(n-1): n-1-ty*ratio%(n-1)));\n\t\t\t\t\t\t\t\t\t\t\tlet posx = x == 1+floor((t%px < px/2 ? t%(n-2): n-3-t%(n-2)));\n\t\t\t\t\t\t\t\t\t\t\tlet isPaddle = (x==0 || x==n-1) && (ty%py < py/2 ? (y<ty*ratio%(n-1)+2&& y>ty*ratio%(n-1)-2) : (y<n-1-ty*ratio%(n-1)+2 && y>n-1-ty*ratio%(n-1)-2));\n\t\t\t\t\t\t\t\t\t\t\treturn isPaddle ? -1 : (posx && posy);",16)),w("tut-start",new F("","return sin(y/8+t);",16,F.DEFAULT_SPEED,['Inspired by <a href="https://tixy.land">tixy.land</a>',"Start the tutorial by clicking the dots"])),w("tut-visibility",new F("","return i%3 == 0;",16,0,["0/1 = false/true => hide/show dots"])),w("tut-scale",new F("","return abs(sin(x/3))",16,0,["use a number from 0 to 1 to define the dot size"])),w("tut-time",new F("","return sin(t);",16,F.DEFAULT_SPEED,["'t' is the time in seconds"])),w("tut-index",new F("","return i/pow(n,2);",16,0,["'i' is the index of the dot, from 0 to nÂ²-1"])),w("tut-x",new F("","return x/n;",16,0,["'x' is the column, 0..n-1"])),w("tut-y",new F("","return y/n;",16,0,["'y' is the row, 0..n-1"])),w("tut-color",new F("","return y-(n/2-0.5);",16,0,["positive numbers are white","negatives are red"])),w("tut-animate",new F("","return y-t;",16,F.DEFAULT_SPEED,["use 't' to animate values"])),w("tut-animate-faster",new F("","return y-t*2;",16,F.DEFAULT_SPEED,["multiply 't' to change the speed"])),w("tut-pattern",new F("","return [0.25, -0.5, 0.75, -1][i%4]",16,0,["Create patterns using arrays"])),w("tut-end",new F("","return sin(t)",16,F.DEFAULT_SPEED,["Edit the code to create your own","Have fun :)"]));var V={get:function(t){return v[t]},gallery:m,tutorial:x,createTransformFunction:function(t){let e,n=!1;try{e=new Function("t","i","x","y","n",`\n\t\t\t\ttry {\n\t\t\t\t\twith(Math) {\n\t\t\t\t\t\t${t}\n\t\t\t\t\t};\n\t\t\t\t} catch(e) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t`)}catch(t){n=!0}return[e,n]},adjustFrame:function(t,e){return t/1e4*e},frameAdjustmentFactor:1e4};var S={vertexShaderSource:"\n\tuniform vec2 u_resolution;\n\tattribute vec2 a_position;\n\tattribute vec2 a_center;\n\tattribute float a_radius;\n\tattribute float a_transform;\n\n\tvarying vec2 v_resolution;\n\tvarying vec2 v_center;\n\tvarying float v_radius;\n\tvarying float v_transform;\n\n\tvoid main() {\n\t\tvec2 pos = (a_position + a_center + vec2(-a_radius, -a_radius)) * vec2(2,-2) + vec2(-1,1);\n\t\tgl_Position = vec4(pos,0,1);\n\n\t\tv_resolution = u_resolution;\n\t\tv_center = a_center;\n\t\tv_radius = a_radius;\n\t\tv_transform = a_transform;\n\t}\n",fragmentShaderSource:"\n\tprecision mediump float;\n\n\tvarying vec2 v_resolution;\n\tvarying vec2 v_center;\n\tvarying float v_radius;\n\tvarying float v_transform;\n\n\tvoid main() {\n\t\tvec2 normalizedCoord = gl_FragCoord.xy/v_resolution * vec2(1,-1) + vec2(0,+1);\n\n\t\tfloat dx = v_center[0] - normalizedCoord.x;\n\t\tfloat dy = v_center[1] - normalizedCoord.y;\n\n\t\tfloat distance = sqrt(dx*dx + dy*dy);\n\t\tfloat radius = v_radius * abs(v_transform);\n\t\tvec4 color = v_transform < .0 ? vec4(1,0,0,1) : vec4(1,1,1,1);\n\n\t\tgl_FragColor += color * smoothstep(radius, radius-0.003, distance);\n\t}\n"};function b(t){return!isNaN(t)}function M(t){let e,n,u;return{c(){e=r("canvas"),this.h()},l(t){e=i(t,"CANVAS",{width:!0,height:!0,class:!0}),s(e).forEach(o),this.h()},h(){a(e,"width",t[0]),a(e,"height",t[0]),a(e,"class","svelte-szljto")},m(r,i){l(r,e,i),t[11](e),n||(u=h(e,"click",t[12]),n=!0)},p(t,[n]){1&n&&a(e,"width",t[0]),1&n&&a(e,"height",t[0])},i:_,o:_,d(r){r&&o(e),t[11](null),n=!1,u()}}}function D(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))};let i,s,o,a,l,h,_,f,T,{frame:p}=e,{speed:d}=e,{hasErrorInCode:E=!1}=e,{code:g}=e,{n:y}=e,{resolution:F=800}=e,v=u();function m(t,e){T=O.rectangle(0,0,1/e,1/e),o.bufferData(l,T),o.uniforms.u_resolution.set([t.canvas.width,t.canvas.height]),o.attribs.a_radius.set(1/e/2),f=[];for(let t=0;t<e;t++)for(let n=0;n<e;n++)f.push((n+.5)/e,(t+.5)/e);o.bufferData(h,f)}function x(){o.use(),o.clear(),function(){let t=[];for(let i=0;i<y;i++)for(let s=0;s<y;s++)t.push((e=a(C,s+i*y,s,i,y),n=-1,r=1,Math.min(Math.max(e,n),r)));var e,n,r;o.bufferData(_,t)}(),o.pointAttr(_,"a_transform",1),o.attribDivisor("a_transform",1),s.drawArraysInstanced(s.TRIANGLES,0,T.length/2,y*y)}c((()=>r(void 0,void 0,void 0,(function*(){n(8,s=i.getContext("webgl2")),o=L.fromSources(s,S.vertexShaderSource,S.fragmentShaderSource),h=s.createBuffer(),l=s.createBuffer(),_=s.createBuffer(),s.viewport(0,0,s.canvas.width,s.canvas.height),m(s,y),o.pointAttr(h,"a_center",2),o.attribDivisor("a_center",1),o.pointAttr(l,"a_position",2),x()}))));let C;return t.$$set=t=>{"frame"in t&&n(4,p=t.frame),"speed"in t&&n(5,d=t.speed),"hasErrorInCode"in t&&n(3,E=t.hasErrorInCode),"code"in t&&n(6,g=t.code),"n"in t&&n(7,y=t.n),"resolution"in t&&n(0,F=t.resolution)},t.$$.update=()=>{if(48&t.$$.dirty&&n(10,C=V.adjustFrame(p,d)),1312&t.$$.dirty&&s&&0!=d&&C&&x(),384&t.$$.dirty&&s&&y&&(m(s,y),x()),72&t.$$.dirty&&g){let t;n(3,[t,E]=V.createTransformFunction(g),E),E||n(9,a=t)}768&t.$$.dirty&&s&&a&&x()},[F,i,v,E,p,d,g,y,s,a,C,function(t){A[t?"unshift":"push"]((()=>{i=t,n(1,i)}))},()=>v("click")]}class I extends t{constructor(t){super(),e(this,t,D,M,n,{frame:4,speed:5,hasErrorInCode:3,code:6,n:7,resolution:0})}}export{I as C,b as i,V as t};
